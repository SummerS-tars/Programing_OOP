# OOP Lab4

---

- [1. 追加大致需求](#1-追加大致需求)
- [2. 具体需求分解](#2-具体需求分解)
- [3. 需求分析](#3-需求分析)
- [4. 重要问题](#4-重要问题)
- [5. 实现思路](#5-实现思路)
- [重点突破](#重点突破)
    - [复杂打印](#复杂打印)
- [Bug修复](#bug修复)

---

## 1. 追加大致需求

1. 增加`peace`模式，符合规则的当前模式则定义为`reversi`模式  
    1. `peace`模式  
    2. `reversi`模式
2. 多局游戏维护逻辑  
    1. 保持多局游戏维护逻辑  
    2. 支持添加新的游戏  
3. 游戏运行  
    1. 合法位置另外标出，并提供无合法位置提示  
    2. 退出程序功能  
    3. 添加新游戏功能  

## 2. 具体需求分解

1. 游戏模式 : 两种模式`peace` & `reversi`
    1. `peace`
        1. 规则：无规则，不可下在已有棋子处  
        2. 游戏结束：棋盘填满  
        3. 胜利条件：无  
    2. `reversi`
        大致按照已经实现的部分来即可  
        1. 换手`pass`操作  
            仅在无合法位置时才能使用  
            并且只有`pass`后才能换手  
2. 多局游戏逻辑  
    1. 多局游戏支持：两种模式  
    2. 游戏列表  
        1. 初始：2局游戏，1`peace` & 2`reversi`  
        2. 添加：输入`peace` or `reversi` 添加新游戏  
        3. 切换：输入游戏编号切换游戏  
    3. 相关功能：  
        1. 单局结束：单个棋盘结束  
        2. 棋盘复盘：棋盘结束后，可以返回查看  
        3. 游戏结束：直接输入`quit`退出程序
3. 信息显示  
    1. 游戏运行相关：  
        1. (`reversi`模式下)标出合法位置，使用`+`  
        2. (`reversi`模式下)显示得分  
        3. 显示当前游戏序号和模式  
    2. 多局游戏信息显示  
        1. 游戏主要信息部分的最右侧显示  
            内容：序号+模式  
    3. 明确的输入支持提示词：  
        1. 落子方及落子格式提示  
        2. 游戏编号范围  
        3. 新建游戏操作(peace/reversi)
        4. 切换回合操作(pass)
        5. 退出程序操作(quit)

## 3. 需求分析

主要新增的部分

1. 实现游戏模式`peace`  
2. 游戏列表新增操作  
3. `reversi`模式下的`pass`操作  
4. 操作提示  
5. 游戏列表显示  

## 4. 重要问题

1. [x]`peace`模式与`reversi`模式如何合理设计？  
    列表如何实现？
2. [x] `reversi`下的合法位置提示如何实现？  
3. [x] `reversi`下的`pass`操作如何在在现有架构下实现？  
4. [x] 游戏主体部分的复杂打印如何实现？  
5. [x] 游戏列表的新建操作如何实现？  
6. [ ] 如何合理留出设计空间，以便后续扩展？  

## 5. 实现思路

首先现有设计架构可能会影响之后的拓展，将进行一定重构  

1. 游戏模式类设计: `GameMode`  
    1. 实现模式选择：继承
    2. 具体实现：`GameMode`使用抽象类，部分方法留空  
    3. `peace`模式实现：`PeaceMode`  
    4. `reversi`模式实现：`ReversiMode`  
2. 游戏列表设计：  
    1. 游戏列表类：`GameList`  
    2. 包含游戏列表相关的域和方法  
3. 游戏主体部分的复杂打印：  
    尝试通过分块打印，实现懒加载的打印方式  
    分块打印基础，ANSI转义序列  
    视情况考虑多色打印  
4. 输入提示设计：  
    合理的打印模式  
5. 错误提示设计：  
    1. 希望可以有更具体的错误提示  
    2. 或许可以通过异常处理实现  

## 重点突破

### 复杂打印

1. 位置记录：字符串拼接 ANSI转义序列
2. 输出刷新：覆盖为主  
3. 输出逻辑：  
    1. 分块负责，通过位置记录实现分块
    2. 单块刷新
        1. 逐行输出  
        2. 通过记录位置偏移换行等  
    3. 位置适应  
        1. 通过游戏状态实现位置记录适应而非硬编码

分配：

```txt
----上部----

棋盘        玩家信息        对局信息

----下部----

输入提示
输入位置

```

分块风格标准：  

1. 棋盘

    ```txt
        字母列
    数
    字  棋盘信息
    行
    ```

2. 玩家信息

    ```txt
    [Player1]name color : score
    [Player2]name color : score
    ```

3. 对局信息

    ```txt
    =========================
    > 1. peace     5. reversi
      2. reversi > 6.
      3. peace     7. 
      4. reversi   8.
    =========================
    ```

    最多支持8局

4. 输入提示

    ```txt
    操作：
    1. [range]落子    2. [range]切换棋盘       3. peace/reversi(增加对局)
    4. pass(跳过回合)  5. quit(退出程序)

    [Player1]name color 回合
    请输入操作：[input]
    ```


## Bug修复

1. [x] 当前回合信息提示错误，没有显示当前回合玩家  
2. [ ] peace模式下显示了玩家棋子数
3. [ ] pass模式显示错误
4. [ ] 游戏结束后显示需要更改
